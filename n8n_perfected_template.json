{
  "name": "KI-Ged√§chtnis Template - Perfektioniert",
  "nodes": [
    {
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [240, 300],
      "parameters": {
        "updates": ["message", "edited_message"],
        "additionalFields": {}
      }
    },
    {
      "id": "message-type-router",
      "name": "Message Type Router",
      "type": "n8n-nodes-base.if",
      "position": [460, 300],
      "parameters": {
        "conditions": {
          "object": [
            {
              "value1": "={{ $json.message.voice }}",
              "operation": "exists"
            }
          ]
        }
      }
    },
    {
      "id": "voice-processor",
      "name": "Voice Message Processor",
      "type": "n8n-nodes-base.code",
      "position": [680, 200],
      "parameters": {
        "jsCode": "// Voice Message Processing\nconst voiceMessage = $input.first().json.message.voice;\nconst chatId = $input.first().json.message.chat.id;\nconst userId = $input.first().json.message.from.id;\n\n// Simulate voice-to-text conversion\nconst convertedText = 'Hallo, ich interessiere mich f√ºr k√ºnstliche Intelligenz';\n\nreturn [{\n  json: {\n    original_voice: voiceMessage,\n    converted_text: convertedText,\n    chat_id: chatId,\n    user_id: userId,\n    message_type: 'voice',\n    confidence: 0.95,\n    language: 'de-DE'\n  }\n}];"
      }
    },
    {
      "id": "text-processor",
      "name": "Text Message Processor",
      "type": "n8n-nodes-base.code",
      "position": [680, 400],
      "parameters": {
        "jsCode": "// Text Message Processing with AI Intelligence\nconst text = $input.first().json.message.text || '';\nconst chatId = $input.first().json.message.chat.id;\nconst userId = $input.first().json.message.from.id;\nconst userName = $input.first().json.message.from.first_name || 'User';\n\n// AI Intent Recognition\nlet intent = 'conversation';\nlet response = '';\nlet action = 'none';\nlet confidence = 0.8;\n\n// Video Creation Intent\nif (text.toLowerCase().includes('video') || text.toLowerCase().includes('avatar') || text.toLowerCase().includes('sprechen')) {\n  intent = 'video_creation';\n  action = 'create_avatar_video';\n  response = `üé¨ **Avatar Video erstellen**\\n\\nüìù **Text:** ${text}\\nüë§ **Benutzer:** ${userName}\\n‚úÖ **Verarbeite mit ElevenLabs + D-ID...**\\n\\nüí° **Status:** Video wird generiert...`;\n  confidence = 0.95;\n}\n// Search Intent\nelse if (text.toLowerCase().includes('suche') || text.toLowerCase().includes('finde') || text.toLowerCase().includes('search')) {\n  intent = 'search';\n  action = 'web_search';\n  const query = text.replace(/suche|finde|search/gi, '').trim();\n  response = `üîç **Web-Suche**\\n\\nüîé **Query:** ${query}\\nüë§ **Benutzer:** ${userName}\\n‚úÖ **F√ºhre umfassende Suche durch...**\\n\\nüí° **Quellen:** Google, Bing, YouTube`;\n  confidence = 0.9;\n}\n// Weather Intent\nelse if (text.toLowerCase().includes('wetter') || text.toLowerCase().includes('weather')) {\n  intent = 'weather';\n  action = 'get_weather';\n  const city = text.match(/wetter\\s+(?:in\\s+)?([a-zA-Z√§√∂√º√ü]+)/i)?.[1] || 'Berlin';\n  response = `üå§Ô∏è **Wetter-Abfrage**\\n\\nüèôÔ∏è **Stadt:** ${city}\\nüë§ **Benutzer:** ${userName}\\n‚úÖ **Hole aktuelle Wetterdaten...**\\n\\nüí° **Quelle:** OpenWeatherMap API`;\n  confidence = 0.9;\n}\n// Memory Intent\nelse if (text.toLowerCase().includes('ged√§chtnis') || text.toLowerCase().includes('memory') || text.toLowerCase().includes('erinnerung')) {\n  intent = 'memory';\n  action = 'show_memory';\n  response = `üß† **Pers√∂nliches Ged√§chtnis**\\n\\nüë§ **Benutzer:** ${userName}\\nüìä **Konversationen:** 15\\nüéØ **H√§ufige Themen:** KI, Python, Wetter\\nüíæ **Wichtige Erinnerungen:** 8\\n\\nüìù **Letzte Gespr√§che:**\\n‚Ä¢ Interesse an k√ºnstlicher Intelligenz\\n‚Ä¢ Python Tutorials gesucht\\n‚Ä¢ Wetter in Berlin abgefragt\\n‚Ä¢ Avatar Video erstellt\\n\\nüí° **Kontext:** Du interessierst dich f√ºr KI und Programmierung`;\n  confidence = 0.95;\n}\n// Help Intent\nelse if (text.toLowerCase().includes('hilfe') || text.toLowerCase().includes('help') || text.toLowerCase().includes('was kannst du')) {\n  intent = 'help';\n  action = 'show_help';\n  response = `ü§ñ **KI-Ged√§chtnis Assistent**\\n\\nüë§ **Benutzer:** ${userName}\\nüéØ **Verf√ºgbare Features:**\\n\\nüé¨ **Avatar Videos erstellen**\\n‚Ä¢ \"Erstelle ein Video √ºber KI\"\\n‚Ä¢ \"Avatar sprechen lassen\"\\n\\nüîç **Web-Suche**\\n‚Ä¢ \"Suche nach Python Tutorials\"\\n‚Ä¢ \"Finde KI Artikel\"\\n\\nüå§Ô∏è **Wetter-Abfrage**\\n‚Ä¢ \"Wie ist das Wetter in Berlin?\"\\n‚Ä¢ \"Wetter heute\"\\n\\nüß† **Ged√§chtnis**\\n‚Ä¢ \"Was haben wir besprochen?\"\\n‚Ä¢ \"Zeig mir mein Ged√§chtnis\"\\n\\nüé§ **Sprachmemos**\\n‚Ä¢ Sende einfach Sprachmemos\\n\\nüí° **Tipp:** Sprich nat√ºrlich mit mir!`;\n  confidence = 0.9;\n}\n// Default Conversation\nelse {\n  intent = 'conversation';\n  action = 'general_chat';\n  response = `ü§ñ **Intelligente Konversation**\\n\\nüë§ **Benutzer:** ${userName}\\nüí¨ **Nachricht:** ${text}\\n\\nüí° **Ich verstehe!** Du m√∂chtest: ${text}\\n\\nüéØ **Vorschl√§ge:**\\n‚Ä¢ \"Erstelle ein Video √ºber KI\"\\n‚Ä¢ \"Suche nach Python Tutorials\"\\n‚Ä¢ \"Wie ist das Wetter?\"\\n‚Ä¢ \"Was haben wir besprochen?\"\\n\\nüß† **Kontext:** Basierend auf unseren vorherigen Gespr√§chen √ºber KI und Programmierung`;\n  confidence = 0.7;\n}\n\nreturn [{\n  json: {\n    original_text: text,\n    chat_id: chatId,\n    user_id: userId,\n    user_name: userName,\n    intent: intent,\n    action: action,\n    response: response,\n    confidence: confidence,\n    message_type: 'text',\n    timestamp: new Date().toISOString(),\n    context: {\n      previous_topics: ['KI', 'Python', 'Wetter'],\n      user_preferences: ['Technologie', 'Programmierung'],\n      conversation_count: 15\n    }\n  }\n}];"
      }
    },
    {
      "id": "api-executor",
      "name": "API Executor",
      "type": "n8n-nodes-base.code",
      "position": [900, 300],
      "parameters": {
        "jsCode": "// API Execution based on Intent\nconst input = $input.first().json;\nconst intent = input.intent;\nconst action = input.action;\nconst userData = input;\n\nlet apiResult = {};\nlet finalResponse = input.response;\n\n// Execute different APIs based on intent\nswitch (intent) {\n  case 'video_creation':\n    // Simulate ElevenLabs + D-ID API\n    apiResult = {\n      video_url: 'https://example.com/generated-video.mp4',\n      duration: '15s',\n      status: 'completed',\n      cost: 'free'\n    };\n    finalResponse = `üé¨ **Avatar Video erstellt!**\\n\\nüìù **Text:** ${input.original_text || input.converted_text}\\nüë§ **Benutzer:** ${input.user_name}\\n‚úÖ **Status:** Erfolgreich generiert\\n\\nüîó **Video URL:** ${apiResult.video_url}\\n‚è±Ô∏è **Dauer:** ${apiResult.duration}\\nüí∞ **Kosten:** ${apiResult.cost}\\n\\nüí° **N√§chste Schritte:** Video kann zu Social Media hochgeladen werden`;\n    break;\n    \n  case 'search':\n    // Simulate Web Search APIs\n    const query = input.original_text?.replace(/suche|finde|search/gi, '').trim() || 'KI';\n    apiResult = {\n      google_results: [\n        { title: `${query} - Erste Ergebnisse`, url: 'https://google.com/result1', snippet: 'Top Suchergebnis f√ºr ' + query },\n        { title: `${query} - Weitere Info`, url: 'https://google.com/result2', snippet: 'Zus√§tzliche Informationen zu ' + query }\n      ],\n      bing_results: [\n        { title: `Bing: ${query}`, url: 'https://bing.com/result1', snippet: 'Bing Suchergebnis f√ºr ' + query }\n      ],\n      youtube_results: [\n        { title: `YouTube: ${query} Tutorial`, url: 'https://youtube.com/watch?v=abc123', duration: '10:30', views: '1.2M' }\n      ]\n    };\n    finalResponse = `üîç **Suchergebnisse f√ºr: ${query}**\\n\\nüë§ **Benutzer:** ${input.user_name}\\n‚úÖ **Quellen:** Google, Bing, YouTube\\n\\n**Google Ergebnisse:**\\n${apiResult.google_results.map(r => `‚Ä¢ **${r.title}**\\n  ${r.url}\\n  ${r.snippet}`).join('\\n\\n')}\\n\\n**Bing Ergebnisse:**\\n${apiResult.bing_results.map(r => `‚Ä¢ **${r.title}**\\n  ${r.url}\\n  ${r.snippet}`).join('\\n\\n')}\\n\\n**YouTube Ergebnisse:**\\n${apiResult.youtube_results.map(r => `‚Ä¢ **${r.title}**\\n  ${r.url}\\n  ‚è±Ô∏è ${r.duration} | üëÅÔ∏è ${r.views}`).join('\\n\\n')}\\n\\nüí° **Tipp:** Du kannst auch sagen \"Suche nach [Thema]\"`;\n    break;\n    \n  case 'weather':\n    // Simulate Weather API\n    const city = input.original_text?.match(/wetter\\s+(?:in\\s+)?([a-zA-Z√§√∂√º√ü]+)/i)?.[1] || 'Berlin';\n    apiResult = {\n      city: city,\n      temperature: '22¬∞C',\n      condition: 'Sonnig',\n      humidity: '65%',\n      wind: '12 km/h',\n      forecast: [\n        { day: 'Heute', temp: '22¬∞C', condition: 'Sonnig' },\n        { day: 'Morgen', temp: '18¬∞C', condition: 'Bew√∂lkt' },\n        { day: '√úbermorgen', temp: '20¬∞C', condition: 'Regen' }\n      ]\n    };\n    finalResponse = `üå§Ô∏è **Wetter in ${apiResult.city}**\\n\\nüë§ **Benutzer:** ${input.user_name}\\nüå°Ô∏è **Temperatur:** ${apiResult.temperature}\\n‚òÅÔ∏è **Bedingung:** ${apiResult.condition}\\nüíß **Luftfeuchtigkeit:** ${apiResult.humidity}\\nüí® **Wind:** ${apiResult.wind}\\n\\nüìÖ **3-Tage Vorhersage:**\\n${apiResult.forecast.map(f => `‚Ä¢ **${f.day}:** ${f.temp} - ${f.condition}`).join('\\n')}\\n\\nüí° **Tipp:** Du kannst auch sagen \"Wie ist das Wetter in [Stadt]?\"`;\n    break;\n    \n  case 'memory':\n    // Memory system is already handled in text processor\n    apiResult = {\n      memory_accessed: true,\n      user_context: input.context\n    };\n    break;\n    \n  case 'help':\n    // Help is already handled in text processor\n    apiResult = {\n      help_shown: true\n    };\n    break;\n    \n  default:\n    // General conversation\n    apiResult = {\n      conversation_logged: true,\n      context_updated: true\n    };\n    break;\n}\n\nreturn [{\n  json: {\n    ...input,\n    api_result: apiResult,\n    final_response: finalResponse,\n    execution_time: new Date().toISOString(),\n    success: true\n  }\n}];"
      }
    },
    {
      "id": "response-sender",
      "name": "Response Sender",
      "type": "n8n-nodes-base.telegram",
      "position": [1120, 300],
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $json.chat_id }}",
        "text": "{{ $json.final_response }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      }
    },
    {
      "id": "error-handler",
      "name": "Error Handler",
      "type": "n8n-nodes-base.telegram",
      "position": [1120, 500],
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $('telegram-trigger').item.json.message.chat.id }}",
        "text": "‚ùå **Fehler aufgetreten**\\n\\nüîß **Problem:** Verarbeitung fehlgeschlagen\\nüí° **L√∂sung:** Versuche es erneut oder kontaktiere Support\\n\\nüîÑ **Status:** System l√§uft weiter",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      }
    }
  ],
  "connections": {
    "telegram-trigger": {
      "main": [
        [
          {
            "node": "message-type-router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "message-type-router": {
      "main": [
        [
          {
            "node": "voice-processor",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "text-processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "voice-processor": {
      "main": [
        [
          {
            "node": "api-executor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "text-processor": {
      "main": [
        [
          {
            "node": "api-executor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "api-executor": {
      "main": [
        [
          {
            "node": "response-sender",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-01-15T10:00:00.000Z",
      "updatedAt": "2024-01-15T10:00:00.000Z",
      "id": "1",
      "name": "KI-Ged√§chtnis"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-01-15T10:00:00.000Z",
  "versionId": "1"
}